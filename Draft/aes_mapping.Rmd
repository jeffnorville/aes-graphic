---
title: "Notes to AES Figures"
author: "Jeff Norville"
#bibliography: C:/Users/Norville/Documents/Bibliotheque/INRA-2018.bib
bibliography: "C:/Users/Jeff Norville/Documents/Mendeley Bibtex/INRA-2018.bib"
output: 
  html_document:
    toc: yes
  pdf_document:
    toc: yes
link-citations: yes
biblio-style: apalike
---

## Reading in the D1.1 Table

I've changed to reading csv files in, as the objects in R really don't appreciate the spaces Excel sometimes obliges.

Second -- the "from/to" design is designed to help use arrows, but now I realise arrows will obscure the green / red idea -- which seems important, particularly in the meta-images.


```{r message=FALSE, echo=FALSE}
#library(readxl)
library(igraph)


# aes_links <- read_excel("C:/Users/Norville/Dropbox/API-SMAL_Partage_Animation/Livrables/D1.1_List_of_AES_English.xlsm",
#                   sheet = "links", skip = 1)
# aes_nodes <- read_excel("C:/Users/Norville/Dropbox/API-SMAL_Partage_Animation/Livrables/D1.1_List_of_AES_English.xlsm",
#                         sheet = "nodes", skip = 1)

aeslinks <- read.csv("../aeslinks.csv", sep=";", header=TRUE, stringsAsFactors = FALSE)
aesnodes <- read.csv("../aesnodes.csv", sep=";", header=TRUE, stringsAsFactors = FALSE)
net <- graph_from_data_frame(d=aeslinks, vertices=aesnodes, directed=T) 
plot(net)

```

## Nicer layout with "physics"
```{r All parts, message=FALSE, echo=FALSE}
library("visNetwork") 
vis.aesnodes <- aesnodes
vis.aeslinks <- aeslinks
vis.aesnodes$shape  <- c("ellipse", "box")[aesnodes$node.type]
vis.aesnodes$shadow <- TRUE # Nodes will drop shadow
vis.aesnodes$title  <- aesnodes$short.definition
vis.aesnodes$label  <- aesnodes$long.definition
vis.aesnodes$borderWidth <- 2 # Node border width
#vis.aesnodes$color.background <- c("lightgrey", "gold")[aesnodes$node.type]
vis.aesnodes$color.border <- "black"
vis.aesnodes$color.highlight.background <- "lightgreen"
vis.aesnodes$color.highlight.border <- "red"

vis.aeslinks$width <- aeslinks$weight*3 # line width
vis.aeslinks$dashes <- aeslinks$type #c(TRUE, FALSE)[aeslinks$type]
#vis.aeslinks$color <- c("green", "red", "black")[aeslinks$color]  
vis.aeslinks$arrows <- "middle"
vis.aeslinks$smooth <- FALSE    # should the edges be curved?
vis.aeslinks$shadow <- FALSE    # edge shadow
vis.aeslinks$labelHighlightBold <- TRUE

visNetwork(vis.aesnodes, vis.aeslinks)
```



## Forest via visNetwork
```{r Forest, message=FALSE}

forestnodes <- read.csv("../forestnodes.csv", sep=";", header=TRUE, as.is = TRUE) # stringsAsFactors = FALSE
forestlinks <- read.csv("../forestlinks.csv", sep=";", header=TRUE, as.is = TRUE)

vis.forestnodes <- forestnodes
vis.forestlinks <- forestlinks

vis.forestnodes$shape  <- c("ellipse", "box")[forestnodes$node.type]
vis.forestnodes$shadow <- FALSE # Nodes will drop shadow
vis.forestnodes$title  <- forestnodes$short.definition
vis.forestnodes$label  <- forestnodes$long.definition
vis.forestnodes$borderWidth <- 1 # Node border width
vis.forestnodes$color.background <- c("gold", "grey")[forestnodes$node.type]
vis.forestnodes$color.border <- "black"
vis.forestnodes$color.highlight.background <- "lightgreen"
vis.forestnodes$color.highlight.border <- "red"

# edges
vis.forestlinks$width <- forestlinks$weight*4 # line width
vis.forestlinks$color <- c("green", "red")[forestlinks$color] #  
vis.forestlinks$arrows <- "middle" # arrows: 'from', 'to', or 'middle'
vis.forestlinks$smooth <- TRUE    # should the edges be curved?
vis.forestlinks$shadow <- FALSE    # edge shadow

visNetwork(vis.forestnodes, vis.forestlinks)
# %>%  visEdges(color = c("green", "red")[forestlinks$color])

```



## Infrastructure AE via visNetwork
```{r Infrastructure AE, message=FALSE}

iaesnodes <- read.csv("../iaesnodes.csv", sep=";", header=TRUE, as.is = TRUE) # stringsAsFactors = FALSE
iaeslinks <- read.csv("../iaeslinks.csv", sep=";", header=TRUE, as.is = TRUE)


vis.iaesnodes <- iaesnodes
vis.iaeslinks <- iaeslinks

vis.iaesnodes$shape  <- c("ellipse", "box")[iaesnodes$node.type]
vis.iaesnodes$shadow <- FALSE # Nodes will drop shadow
vis.iaesnodes$title  <- iaesnodes$short.definition
vis.iaesnodes$label  <- iaesnodes$long.definition
vis.iaesnodes$borderWidth <- 1 # Node border width
vis.iaesnodes$color.background <- c("gold", "grey")[iaesnodes$node.type]
vis.iaesnodes$color.border <- "black"
vis.iaesnodes$color.highlight.background <- "lightgreen"
vis.iaesnodes$color.highlight.border <- "red"

# edges
vis.iaeslinks$color <- c("green", "red")[iaeslinks$color] #line color  
vis.iaeslinks$width <- iaeslinks$weight*4 # line width
vis.iaeslinks$arrows <- "middle" # arrows: 'from', 'to', or 'middle'
vis.iaeslinks$smooth <- TRUE    # should the edges be curved?
vis.iaeslinks$shadow <- FALSE    # edge shadow
vis.iaeslinks$color <- c("green", "red")[iaeslinks$color] #line color  

visNetwork(vis.iaesnodes, vis.iaeslinks) %>%
  visEdges(color = c("green", "red")[iaeslinks$color])


```


## Crop Choice via visNetwork
```{r Crop Choice, message=FALSE}

ccnodes <- read.csv("../cropchoicenodes.csv", sep=";", header=TRUE, as.is = TRUE) # stringsAsFactors = FALSE
cclinks <- read.csv("../cropchoicelinks.csv", sep=";", header=TRUE, as.is = TRUE)

vis.ccnodes <- ccnodes
vis.cclinks <- cclinks

vis.ccnodes$shape  <- c("ellipse", "box")[ccnodes$node.type]
vis.ccnodes$shadow <- FALSE # Nodes will drop shadow
vis.ccnodes$title  <- ccnodes$short.definition
vis.ccnodes$label  <- ccnodes$long.definition
vis.ccnodes$borderWidth <- 1 # Node border width
#vis.ccnodes$color.background <- iaesnodes$node.type
#vis.ccnodes$color.background[c("challenge", "solution")] <- c("gold", "grey")
vis.ccnodes$color.border <- "black"
vis.ccnodes$color.highlight.background <- "lightgreen"
vis.ccnodes$color.highlight.border <- "red"

# edges
vis.cclinks$color <- c("green", "red")[cclinks$color] #line color  
vis.cclinks$width <- cclinks$weight*4 # line width
vis.cclinks$arrows <- "middle" # arrows: 'from', 'to', or 'middle'
vis.cclinks$smooth <- TRUE    # should the edges be curved?
vis.cclinks$shadow <- FALSE    # edge shadow
vis.cclinks$color <- c("green", "red")[cclinks$color] #line color  

visNetwork(vis.ccnodes, vis.cclinks) 


```




## Varietal choice via visNetwork
```{r Varietal choice, message=FALSE, echo=FALSE}

varchoicenodes <- read.csv("../varchoicenodes.csv", sep=";", header=TRUE, as.is = TRUE) # stringsAsFactors = FALSE
varchoicelinks <- read.csv("../varchoicelinks.csv", sep=";", header=TRUE, as.is = TRUE)

vis.varchoicenodes <- varchoicenodes
vis.varchoicelinks <- varchoicelinks

vis.varchoicenodes$shape  <- c("ellipse", "box")[varchoicenodes$node.type]
vis.varchoicenodes$shadow <- FALSE # Nodes will drop shadow
vis.varchoicenodes$title  <- varchoicenodes$short.definition
vis.varchoicenodes$label  <- varchoicenodes$long.definition
vis.varchoicenodes$borderWidth <- 1 # Node border width
vis.varchoicenodes$color.background <- c("gold", "grey")[varchoicenodes$node.type]
vis.varchoicenodes$color.border <- "black"
vis.varchoicenodes$color.highlight.background <- "lightgreen"
vis.varchoicenodes$color.highlight.border <- "red"

# edges
vis.varchoicelinks$width <- varchoicelinks$weight*4 # line width
vis.varchoicelinks$color <- c("green", "red")[varchoicelinks$color] #  
vis.varchoicelinks$arrows <- "middle" # arrows: 'from', 'to', or 'middle'
vis.varchoicelinks$smooth <- TRUE    # should the edges be curved?
vis.varchoicelinks$shadow <- FALSE    # edge shadow

visNetwork(vis.varchoicenodes, vis.varchoicelinks)

```



## Working the soil via visNetwork
```{r Working the soil, message=FALSE}

soilnodes <- read.csv("../wtsnodes.csv", sep=";", header=TRUE, as.is = TRUE) # stringsAsFactors = FALSE
soillinks <- read.csv("../wtslinks.csv", sep=";", header=TRUE, as.is = TRUE)

vis.soilnodes <- soilnodes
vis.soillinks <- soillinks

vis.soilnodes$shape  <- c("ellipse", "box")[soilnodes$node.type]
vis.soilnodes$shadow <- FALSE # Nodes will drop shadow
vis.soilnodes$title  <- soilnodes$short.definition
vis.soilnodes$label  <- soilnodes$long.definition
vis.soilnodes$borderWidth <- 1 # Node border width
vis.soilnodes$color.background <- c("gold", "grey")[soilnodes$node.type]
vis.soilnodes$color.border <- "black"
vis.soilnodes$color.highlight.background <- "lightgreen"
vis.soilnodes$color.highlight.border <- "red"

# edges
vis.soillinks$width <- soillinks$weight*4 # line width
vis.soillinks$color <- c("green", "red")[soillinks$color] #"green"    # line color  
vis.soillinks$arrows <- "middle" # arrows: 'from', 'to', or 'middle'
vis.soillinks$smooth <- TRUE    # should the edges be curved?
vis.soillinks$shadow <- FALSE    # edge shadow



visNetwork(vis.soilnodes, vis.soillinks) 

```




## Discussion

Still having trouble with line color, arrows and labels on ligns are correct. Widths are proportionate to "weight".

I'll add figures for the D1.1 table inline here, then we can collaberate in-line below.

Can I add datatables too?

=======

Practice a citation like @Bayer2019


